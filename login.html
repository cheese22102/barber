<!DOCTYPE html>
<html lang="fr" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Staff Login - BarberShop</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        dark: {
                            bg: '#121212',
                            surface: '#1E1E1E',
                            text: '#E5E7EB',
                            secondary: '#9CA3AF',
                            border: '#374151'
                        },
                        light: {
                            bg: '#F9FAFB',
                            surface: '#FFFFFF',
                            text: '#374151',
                            secondary: '#6B7280',
                            border: '#E5E7EB'
                        },
                        accent: {
                            whatsapp: '#25D366',
                            success: '#10B981',
                            selected: '#000000'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        arabic: ['Cairo', 'sans-serif']
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-light-bg dark:bg-dark-bg text-light-text dark:text-dark-text min-h-screen font-sans flex items-center justify-center px-4">
    <!-- Language and Theme Toggles -->
    <div class="fixed top-4 right-4 z-50 flex items-center gap-2">
        <!-- Language Switcher -->
        <div class="relative">
            <button id="langBtn" class="flex items-center gap-1 px-3 py-2 rounded-xl bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border text-sm font-bold transition-all hover:scale-105 active:scale-95 shadow-lg">
                <span id="currentLang">FR</span>
                <svg class="w-3 h-3 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                </svg>
            </button>
            <div id="langDropdown" class="absolute top-full mt-2 right-0 bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-xl shadow-lg opacity-0 invisible transition-all duration-200 z-50 min-w-[80px]">
                <button onclick="setLanguage('fr')" class="w-full px-4 py-2 text-left text-sm font-bold hover:bg-light-bg dark:hover:bg-dark-bg rounded-t-xl transition-colors">FR</button>
                <button onclick="setLanguage('ar')" class="w-full px-4 py-2 text-left text-sm font-bold hover:bg-light-bg dark:hover:bg-dark-bg transition-colors">AR</button>
                <button onclick="setLanguage('en')" class="w-full px-4 py-2 text-left text-sm font-bold hover:bg-light-bg dark:hover:bg-dark-bg rounded-b-xl transition-colors">EN</button>
            </div>
        </div>
        <button id="themeToggle" class="p-3 rounded-xl bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border transition-all hover:scale-105 active:scale-95 shadow-lg">
            <svg id="sunIcon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"></path></svg>
            <svg id="moonIcon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
        </button>
    </div>

    <div class="w-full max-w-md bg-light-surface dark:bg-dark-surface p-8 rounded-3xl shadow-xl border border-light-border dark:border-dark-border">
        <div class="mb-8 text-center">
            <h1 class="text-3xl font-bold mb-2" data-i18n="login_title">BarberShop Login</h1>
            <p class="text-sm text-light-secondary dark:text-dark-secondary" data-i18n="login_subtitle">Connexion administrateur ou personnel</p>
        </div>

        <!-- Role Selection -->
        <div class="mb-6">
            <div class="flex rounded-xl bg-light-bg dark:bg-dark-bg p-1">
                <button id="staffBtn" class="flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all bg-accent-selected dark:bg-light-surface text-light-surface dark:text-dark-text" data-i18n="staff_role">Personnel</button>
                <button id="adminBtn" class="flex-1 py-2 px-4 rounded-lg text-sm font-medium transition-all text-light-secondary dark:text-dark-secondary" data-i18n="admin_role">Admin</button>
            </div>
        </div>

        <form id="loginForm" class="space-y-4">
            <div>
                <label class="block text-sm font-medium mb-1" data-i18n="email_label">Email</label>
                <input type="email" id="email" required class="w-full p-4 rounded-xl bg-light-bg dark:bg-dark-bg border border-light-border dark:border-dark-border outline-none focus:ring-2 focus:ring-accent-selected text-base">
            </div>
            <div>
                <label class="block text-sm font-medium mb-1" data-i18n="password_label">Mot de passe</label>
                <input type="password" id="password" required class="w-full p-4 rounded-xl bg-light-bg dark:bg-dark-bg border border-light-border dark:border-dark-border outline-none focus:ring-2 focus:ring-accent-selected text-base">
            </div>
            <button type="submit" class="w-full bg-accent-selected dark:bg-light-surface text-light-surface dark:text-dark-text font-bold py-4 rounded-xl hover:opacity-90 transition-all" data-i18n="login_button">
                Se connecter
            </button>
        </form>

        <div class="mt-6 text-center">
            <a href="index.html" class="text-sm text-light-secondary dark:text-dark-secondary hover:text-light-text dark:hover:text-dark-text transition-colors" data-i18n="back_home">Retour à l'accueil</a>
        </div>
    </div>

    <!-- Snackbar for notifications -->
    <div id="snackbar" class="fixed bottom-4 left-4 right-4 md:left-auto md:right-4 md:w-96 z-50 opacity-0 invisible transition-all duration-300">
        <div class="bg-light-surface dark:bg-dark-surface border border-light-border dark:border-dark-border rounded-xl p-4 shadow-lg flex items-center gap-3">
            <div id="snackbarIcon" class="flex-shrink-0 w-6 h-6">
                <!-- Icon will be set by JavaScript -->
            </div>
            <div class="flex-1">
                <p id="snackbarMessage" class="text-sm font-medium"></p>
            </div>
            <button id="snackbarClose" class="flex-shrink-0 w-5 h-5 text-light-secondary dark:text-dark-secondary hover:text-light-text dark:hover:text-dark-text transition-colors">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    </div>

    <script type="module">
        const MOCK_MODE = false;

        const i18n = {
            fr: {
                login_title: "Connexion BarberShop",
                login_subtitle: "Accès administrateur ou personnel",
                staff_role: "Personnel",
                admin_role: "Admin",
                email_label: "Adresse email",
                password_label: "Mot de passe",
                login_button: "Se connecter",
                back_home: "Retour à l'accueil",
                login_error: "Erreur de connexion",
                login_success: "Connexion réussie",
                invalid_credentials: "Identifiants invalides",
                access_denied: "Accès refusé",
                staff_added: "Membre ajouté avec succès",
                staff_removed: "Membre supprimé avec succès"
            },
            ar: {
                login_title: "تسجيل دخول صالون الحلاقة",
                login_subtitle: "الوصول للإدارة أو الموظفين",
                staff_role: "الموظفين",
                admin_role: "المدير",
                email_label: "البريد الإلكتروني",
                password_label: "كلمة المرور",
                login_button: "تسجيل الدخول",
                back_home: "العودة للرئيسية",
                login_error: "خطأ في تسجيل الدخول",
                login_success: "تم تسجيل الدخول بنجاح",
                invalid_credentials: "بيانات الدخول غير صحيحة",
                access_denied: "تم رفض الوصول",
                staff_added: "تم إضافة العضو بنجاح",
                staff_removed: "تم حذف العضو بنجاح"
            },
            en: {
                login_title: "BarberShop Login",
                login_subtitle: "Admin or staff access",
                staff_role: "Staff",
                admin_role: "Admin",
                email_label: "Email address",
                password_label: "Password",
                login_button: "Sign in",
                back_home: "Back to home",
                login_error: "Login error",
                login_success: "Login successful",
                invalid_credentials: "Invalid credentials",
                access_denied: "Access denied",
                staff_added: "Member added successfully",
                staff_removed: "Member removed successfully"
            }
        };

        let currentLang = localStorage.getItem('lang') || 'fr';

        // Snackbar Elements
        const snackbar = document.getElementById('snackbar');
        const snackbarIcon = document.getElementById('snackbarIcon');
        const snackbarMessage = document.getElementById('snackbarMessage');
        const snackbarClose = document.getElementById('snackbarClose');

        // Snackbar functionality
        function showSnackbar(message, type = 'info', duration = 4000) {
            // Set icon based on type
            let iconSvg = '';
            switch (type) {
                case 'success':
                    iconSvg = '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>';
                    break;
                case 'error':
                    iconSvg = '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>';
                    break;
                case 'warning':
                    iconSvg = '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path></svg>';
                    break;
                default:
                    iconSvg = '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>';
            }
            snackbarIcon.innerHTML = iconSvg;

            // Set message
            snackbarMessage.textContent = message;

            // Show snackbar
            snackbar.classList.remove('opacity-0', 'invisible');
            snackbar.classList.add('opacity-100');

            // Auto hide after duration
            setTimeout(() => {
                hideSnackbar();
            }, duration);
        }

        function hideSnackbar() {
            snackbar.classList.remove('opacity-100');
            snackbar.classList.add('opacity-0', 'invisible');
        }

        // Close snackbar on click
        snackbarClose.addEventListener('click', hideSnackbar);

        function setLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('lang', lang);
            document.documentElement.lang = lang;
            document.documentElement.dir = lang === 'ar' ? 'rtl' : 'ltr';

            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                el.textContent = i18n[lang][key];
            });

            updateCurrentLangDisplay();
            closeLangDropdown();
        }

        // Language Dropdown Logic
        const langBtn = document.getElementById('langBtn');
        const currentLangDisplay = document.getElementById('currentLang');
        const langDropdown = document.getElementById('langDropdown');

        function toggleLangDropdown() {
            const isVisible = !langDropdown.classList.contains('opacity-0');
            if (isVisible) {
                closeLangDropdown();
            } else {
                openLangDropdown();
            }
        }

        function openLangDropdown() {
            langDropdown.classList.remove('opacity-0', 'invisible');
            langBtn.querySelector('svg').style.transform = 'rotate(180deg)';
        }

        function closeLangDropdown() {
            langDropdown.classList.add('opacity-0', 'invisible');
            langBtn.querySelector('svg').style.transform = 'rotate(0deg)';
        }

        function updateCurrentLangDisplay() {
            currentLangDisplay.textContent = currentLang.toUpperCase();
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!langBtn.contains(e.target) && !langDropdown.contains(e.target)) {
                closeLangDropdown();
            }
        });

        // Firebase Setup
        const firebaseConfig = {
            apiKey: "AIzaSyAVmBbX-5cS07XTq6RSImH6TpOLM_nI-R8",
            authDomain: "barbershop-quick-book.firebaseapp.com",
            projectId: "barbershop-quick-book",
            storageBucket: "barbershop-quick-book.firebasestorage.app",
            messagingSenderId: "863498811120",
            appId: "1:863498811120:web:55f7fc647156bc91cdb435"
        };

        let auth = null;
        let db = null;
        let selectedRole = 'staff'; // Default to staff

        // Role selection logic
        const staffBtn = document.getElementById('staffBtn');
        const adminBtn = document.getElementById('adminBtn');

        staffBtn.addEventListener('click', () => {
            selectedRole = 'staff';
            staffBtn.classList.add('bg-accent-selected', 'dark:bg-light-surface', 'text-light-surface', 'dark:text-dark-text');
            staffBtn.classList.remove('text-light-secondary', 'dark:text-dark-secondary');
            adminBtn.classList.remove('bg-accent-selected', 'dark:bg-light-surface', 'text-light-surface', 'dark:text-dark-text');
            adminBtn.classList.add('text-light-secondary', 'dark:text-dark-secondary');
        });

        adminBtn.addEventListener('click', () => {
            selectedRole = 'admin';
            adminBtn.classList.add('bg-accent-selected', 'dark:bg-light-surface', 'text-light-surface', 'dark:text-dark-text');
            adminBtn.classList.remove('text-light-secondary', 'dark:text-dark-secondary');
            staffBtn.classList.remove('bg-accent-selected', 'dark:bg-light-surface', 'text-light-surface', 'dark:text-dark-text');
            staffBtn.classList.add('text-light-secondary', 'dark:text-dark-secondary');
        });

        if (!MOCK_MODE) {
            // Import Firebase modules dynamically
            import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js').then(({ initializeApp }) => {
                import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js').then(({ getAuth, signInWithEmailAndPassword }) => {
                    import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js').then(({ getFirestore, collection, query, where, getDocs }) => {
                        const app = initializeApp(firebaseConfig);
                        auth = getAuth(app);
                        db = getFirestore(app);

                        // Make Firebase functions globally available
                        window.signInWithEmailAndPassword = signInWithEmailAndPassword;
                        window.collection = collection;
                        window.query = query;
                        window.where = where;
                        window.getDocs = getDocs;

                        console.log('Firebase Auth and Firestore initialized');
                    });
                });
            });
        }

        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            if (MOCK_MODE) {
                // In mock mode, any non-empty credentials work
                localStorage.setItem('isLoggedIn', 'true');
                if (selectedRole === 'admin') {
                    localStorage.setItem('userRole', 'admin');
                    window.location.href = 'admin.html';
                } else {
                    localStorage.setItem('userRole', 'staff');
                    localStorage.setItem('barberId', '1');
                    localStorage.setItem('staffName', 'Ahmed');
                    window.location.href = 'staff.html';
                }
            } else {
                try {
                    if (!auth || !db) {
                        throw new Error("Firebase not initialized");
                    }

                    const userCredential = await signInWithEmailAndPassword(auth, email, password);
                    const user = userCredential.user;

                    if (selectedRole === 'admin') {
                        // Check if user is admin (you need to create an admin user in Firebase Auth)
                        // For now, assume admin@barbershop.com is the admin
                        if (email === 'admin@barbershop.com') {
                            localStorage.setItem('isLoggedIn', 'true');
                            localStorage.setItem('userRole', 'admin');
                            localStorage.setItem('adminEmail', email);
                            localStorage.setItem('adminPassword', password); // Store for re-authentication
                            window.location.href = 'admin.html';
                        } else {
                            throw new Error("Accès administrateur refusé");
                        }
                    } else {
                        // Staff login - get barber info from staff collection
                        const staffQuery = query(collection(db, "staff"), where("email", "==", email));
                        const staffSnapshot = await getDocs(staffQuery);

                        if (staffSnapshot.empty) {
                            throw new Error("Compte personnel introuvable");
                        }

                        const staffDoc = staffSnapshot.docs[0];
                        const staffData = staffDoc.data();

                        // Store authentication state
                        localStorage.setItem('isLoggedIn', 'true');
                        localStorage.setItem('userRole', 'staff');
                        localStorage.setItem('barberId', staffData.barber_id.toString());
                        localStorage.setItem('staffName', staffData.name);

                        window.location.href = 'staff.html';
                    }
                } catch (error) {
                    console.error("Login error:", error);
                    showSnackbar(i18n[currentLang].login_error + ": " + error.message, 'error');
                }
            }
        });

        // Theme toggle functionality
        const themeToggle = document.getElementById('themeToggle');
        const sunIcon = document.getElementById('sunIcon');
        const moonIcon = document.getElementById('moonIcon');

        function setTheme(theme) {
            localStorage.setItem('theme', theme);
            if (theme === 'dark') {
                document.documentElement.classList.add('dark');
                sunIcon.classList.remove('hidden');
                moonIcon.classList.add('hidden');
            } else {
                document.documentElement.classList.remove('dark');
                sunIcon.classList.add('hidden');
                moonIcon.classList.remove('hidden');
            }
        }

        function toggleTheme() {
            const currentTheme = localStorage.getItem('theme') || 'light';
            setTheme(currentTheme === 'dark' ? 'light' : 'dark');
        }

        themeToggle.addEventListener('click', toggleTheme);

        // Language dropdown setup
        langBtn.addEventListener('click', toggleLangDropdown);
        updateCurrentLangDisplay();

        // Sync theme with main page
        const savedTheme = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
        setTheme(savedTheme);
    </script>
</body>
</html>
